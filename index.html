<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作品集 - 修复版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #111;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .container {
            width: 100%;
            max-width: 75vw;
            margin: 0 auto;
        }

        /* 占位符样式 */
        .placeholder {
            width: 100%;
            height: 400px; /* 根据图片比例调整 */
            background: #222;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .placeholder::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255,255,255,0.1),
                transparent
            );
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            100% { left: 200%; }
        }

        .gallery-image {
            width: 100%;
            height: auto;
            opacity: 0;
            transition: opacity 0.5s;
            border-radius: 8px;
        }

        .loaded {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="works" class="gallery-container"></div>
    </div>

    <script>
        async function loadGallery() {
            const container = document.getElementById('works');
            let index = 1;
            
            while(true) {
                const imgUrl = `./folio/${index}.png`;
                const imgExists = await checkImageExists(imgUrl);
                
                if(!imgExists) break;

                // 创建占位容器
                const placeholder = document.createElement('div');
                placeholder.className = 'placeholder';
                container.appendChild(placeholder);

                // 创建图片元素
                const img = new Image();
                img.className = 'gallery-image';
                img.loading = 'lazy';
                img.alt = `作品 ${index}`;

                // 图片加载完成处理
                img.onload = () => {
                    placeholder.style.background = 'none'; // 移除占位背景
                    placeholder.innerHTML = '';
                    placeholder.appendChild(img);
                    img.classList.add('loaded');
                };

                // 错误处理
                img.onerror = () => {
                    placeholder.remove(); // 移除加载失败的占位符
                };

                // 使用IntersectionObserver实现视口加载
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if(entry.isIntersecting) {
                            img.src = imgUrl;
                            observer.unobserve(placeholder);
                        }
                    });
                }, { rootMargin: '200px' });

                observer.observe(placeholder);
                index++;
            }
        }

        // 检测图片是否存在
        function checkImageExists(url) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }

        // 初始化加载
        window.addEventListener('DOMContentLoaded', loadGallery);
    </script>
</body>
</html>
